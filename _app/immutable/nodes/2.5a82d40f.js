import{r as vt,P as yt,a as Ue,g as qe}from"../chunks/apiFetch.bc854194.js";import{a as fe,l as $e}from"../chunks/loadingStore.store.cd0289c0.js";import{s as ze,d as pe,u as me,f as be,h as we,j as oe,c as De,e as Re,r as xe,k as Ct,l as se,m as re,b as Ae,g as Oe,i as et,p as St,q as kt}from"../chunks/scheduler.7a7c0b35.js";import{S as Xe,i as Je,g as R,h as A,j as W,f as w,k as g,a as J,d as B,t as G,s as Z,c as q,x as P,z as X,p as Be,b as Fe,A as Et,B as ce,m as He,r as gt,C as je,n as Le,u as _t,D as Te,v as pt,o as Me,w as mt,e as tt,E as It,F as Tt}from"../chunks/index.0a1868cf.js";import{e as nt}from"../chunks/each.e59479a4.js";import{p as Pt}from"../chunks/stores.5f8033b7.js";function Dt(n){let e,t,o;const s=n[12].default,r=pe(s,n,n[11],null);return{c(){e=R("div"),r&&r.c(),this.h()},l(i){e=A(i,"DIV",{class:!0,role:!0,"aria-labelledby":!0,"data-testid":!0});var a=W(e);r&&r.l(a),a.forEach(w),this.h()},h(){g(e,"class",t="listbox "+n[1]),g(e,"role","listbox"),g(e,"aria-labelledby",n[0]),g(e,"data-testid","listbox")},m(i,a){J(i,e,a),r&&r.m(e,null),o=!0},p(i,[a]){r&&r.p&&(!o||a&2048)&&me(r,s,i,i[11],o?we(s,i[11],a,null):be(i[11]),null),(!o||a&2&&t!==(t="listbox "+i[1]))&&g(e,"class",t),(!o||a&1)&&g(e,"aria-labelledby",i[0])},i(i){o||(B(r,i),o=!0)},o(i){G(r,i),o=!1},d(i){i&&w(e),r&&r.d(i)}}}const Rt="";function At(n,e,t){let o,{$$slots:s={},$$scope:r}=e,{multiple:i=!1}=e,{spacing:a="space-y-1"}=e,{rounded:c="rounded-token"}=e,{active:h="variant-filled"}=e,{hover:u="hover:variant-soft"}=e,{padding:m="px-4 py-2"}=e,{regionLead:b=""}=e,{regionDefault:v=""}=e,{regionTrail:L=""}=e,{labelledby:M=""}=e;return oe("multiple",i),oe("rounded",c),oe("active",h),oe("hover",u),oe("padding",m),oe("regionLead",b),oe("regionDefault",v),oe("regionTrail",L),n.$$set=p=>{t(13,e=De(De({},e),Re(p))),"multiple"in p&&t(2,i=p.multiple),"spacing"in p&&t(3,a=p.spacing),"rounded"in p&&t(4,c=p.rounded),"active"in p&&t(5,h=p.active),"hover"in p&&t(6,u=p.hover),"padding"in p&&t(7,m=p.padding),"regionLead"in p&&t(8,b=p.regionLead),"regionDefault"in p&&t(9,v=p.regionDefault),"regionTrail"in p&&t(10,L=p.regionTrail),"labelledby"in p&&t(0,M=p.labelledby),"$$scope"in p&&t(11,r=p.$$scope)},n.$$.update=()=>{t(1,o=`${Rt} ${a} ${c} ${e.class??""}`)},e=Re(e),[M,o,i,a,c,h,u,m,b,v,L,r,s]}class Ht extends Xe{constructor(e){super(),Je(this,e,At,Dt,ze,{multiple:2,spacing:3,rounded:4,active:5,hover:6,padding:7,regionLead:8,regionDefault:9,regionTrail:10,labelledby:0})}}const Lt=n=>({}),ot=n=>({}),Mt=n=>({}),st=n=>({});function Nt(n){let e,t=!1,o,s,r;return o=Et(n[35][0]),{c(){e=R("input"),this.h()},l(i){e=A(i,"INPUT",{type:!0,name:!0,tabindex:!0}),this.h()},h(){g(e,"type","radio"),g(e,"name",n[1]),e.__value=n[2],ce(e,e.__value),g(e,"tabindex","-1"),o.p(e)},m(i,a){J(i,e,a),n[33](e),e.checked=e.__value===n[0],s||(r=[X(e,"change",n[34]),X(e,"click",n[29]),X(e,"change",n[30])],s=!0)},p(i,a){a[0]&2&&g(e,"name",i[1]),a[0]&4&&(e.__value=i[2],ce(e,e.__value),t=!0),(t||a[0]&1)&&(e.checked=e.__value===i[0])},d(i){i&&w(e),n[33](null),o.r(),s=!1,xe(r)}}}function xt(n){let e,t,o;return{c(){e=R("input"),this.h()},l(s){e=A(s,"INPUT",{type:!0,name:!0,tabindex:!0}),this.h()},h(){g(e,"type","checkbox"),g(e,"name",n[1]),e.__value=n[2],ce(e,e.__value),g(e,"tabindex","-1")},m(s,r){J(s,e,r),n[31](e),e.checked=n[4],t||(o=[X(e,"change",n[32]),X(e,"click",n[27]),X(e,"change",n[28])],t=!0)},p(s,r){r[0]&2&&g(e,"name",s[1]),r[0]&4&&(e.__value=s[2],ce(e,e.__value)),r[0]&16&&(e.checked=s[4])},d(s){s&&w(e),n[31](null),t=!1,xe(o)}}}function it(n){let e,t,o;const s=n[23].lead,r=pe(s,n,n[22],st);return{c(){e=R("div"),r&&r.c(),this.h()},l(i){e=A(i,"DIV",{class:!0});var a=W(e);r&&r.l(a),a.forEach(w),this.h()},h(){g(e,"class",t="listbox-label-lead "+n[9])},m(i,a){J(i,e,a),r&&r.m(e,null),o=!0},p(i,a){r&&r.p&&(!o||a[0]&4194304)&&me(r,s,i,i[22],o?we(s,i[22],a,Mt):be(i[22]),st),(!o||a[0]&512&&t!==(t="listbox-label-lead "+i[9]))&&g(e,"class",t)},i(i){o||(B(r,i),o=!0)},o(i){G(r,i),o=!1},d(i){i&&w(e),r&&r.d(i)}}}function rt(n){let e,t,o;const s=n[23].trail,r=pe(s,n,n[22],ot);return{c(){e=R("div"),r&&r.c(),this.h()},l(i){e=A(i,"DIV",{class:!0});var a=W(e);r&&r.l(a),a.forEach(w),this.h()},h(){g(e,"class",t="listbox-label-trail "+n[7])},m(i,a){J(i,e,a),r&&r.m(e,null),o=!0},p(i,a){r&&r.p&&(!o||a[0]&4194304)&&me(r,s,i,i[22],o?we(s,i[22],a,Lt):be(i[22]),ot),(!o||a[0]&128&&t!==(t="listbox-label-trail "+i[7]))&&g(e,"class",t)},i(i){o||(B(r,i),o=!0)},o(i){G(r,i),o=!1},d(i){i&&w(e),r&&r.d(i)}}}function Wt(n){let e,t,o,s,r,i,a,c,h,u,m,b,v,L;function M(f,C){return f[3]?xt:Nt}let p=M(n),I=p(n),E=n[13].lead&&it(n);const K=n[23].default,y=pe(K,n,n[22],null);let S=n[13].trail&&rt(n);return{c(){e=R("label"),t=R("div"),o=R("div"),I.c(),s=Z(),r=R("div"),E&&E.c(),i=Z(),a=R("div"),y&&y.c(),h=Z(),S&&S.c(),this.h()},l(f){e=A(f,"LABEL",{});var C=W(e);t=A(C,"DIV",{class:!0,"data-testid":!0,role:!0,"aria-selected":!0,tabindex:!0});var V=W(t);o=A(V,"DIV",{class:!0});var _=W(o);I.l(_),_.forEach(w),s=q(V),r=A(V,"DIV",{class:!0});var T=W(r);E&&E.l(T),i=q(T),a=A(T,"DIV",{class:!0});var O=W(a);y&&y.l(O),O.forEach(w),h=q(T),S&&S.l(T),T.forEach(w),V.forEach(w),C.forEach(w),this.h()},h(){g(o,"class","h-0 w-0 overflow-hidden"),g(a,"class",c="listbox-label-content "+n[8]),g(r,"class",u="listbox-label "+n[10]),g(t,"class",m="listbox-item "+n[11]),g(t,"data-testid","listbox-item"),g(t,"role","option"),g(t,"aria-selected",n[5]),g(t,"tabindex","0")},m(f,C){J(f,e,C),P(e,t),P(t,o),I.m(o,null),P(t,s),P(t,r),E&&E.m(r,null),P(r,i),P(r,a),y&&y.m(a,null),P(r,h),S&&S.m(r,null),b=!0,v||(L=[X(t,"keydown",n[12]),X(t,"keydown",n[24]),X(t,"keyup",n[25]),X(t,"keypress",n[26])],v=!0)},p(f,C){p===(p=M(f))&&I?I.p(f,C):(I.d(1),I=p(f),I&&(I.c(),I.m(o,null))),f[13].lead?E?(E.p(f,C),C[0]&8192&&B(E,1)):(E=it(f),E.c(),B(E,1),E.m(r,i)):E&&(Be(),G(E,1,1,()=>{E=null}),Fe()),y&&y.p&&(!b||C[0]&4194304)&&me(y,K,f,f[22],b?we(K,f[22],C,null):be(f[22]),null),(!b||C[0]&256&&c!==(c="listbox-label-content "+f[8]))&&g(a,"class",c),f[13].trail?S?(S.p(f,C),C[0]&8192&&B(S,1)):(S=rt(f),S.c(),B(S,1),S.m(r,null)):S&&(Be(),G(S,1,1,()=>{S=null}),Fe()),(!b||C[0]&1024&&u!==(u="listbox-label "+f[10]))&&g(r,"class",u),(!b||C[0]&2048&&m!==(m="listbox-item "+f[11]))&&g(t,"class",m),(!b||C[0]&32)&&g(t,"aria-selected",f[5])},i(f){b||(B(E),B(y,f),B(S),b=!0)},o(f){G(E),G(y,f),G(S),b=!1},d(f){f&&w(e),I.d(),E&&E.d(),y&&y.d(f),S&&S.d(),v=!1,xe(L)}}}const jt="cursor-pointer -outline-offset-[3px]",Ut="flex items-center space-x-4",Ot="",Bt="flex-1",Ft="";function Ve(n,e){if(n===e)return!0;if(!(n instanceof Object)||!(e instanceof Object))return!1;const t=Object.keys(n),o=Object.keys(e);if(t.length!==o.length)return!1;for(const s of t){const r=n[s],i=e[s];if(!Ve(r,i))return!1}return!0}function Vt(n,e,t){let o,s,r,i,a,c,h,{$$slots:u={},$$scope:m}=e;const b=Ct(u);let{group:v}=e,{name:L}=e,{value:M}=e,{multiple:p=se("multiple")}=e,{rounded:I=se("rounded")}=e,{active:E=se("active")}=e,{hover:K=se("hover")}=e,{padding:y=se("padding")}=e,{regionLead:S=se("regionLead")}=e,{regionDefault:f=se("regionDefault")}=e,{regionTrail:C=se("regionTrail")}=e,V,_;function T(d){t(4,V=d.indexOf(M)>=0)}function O(d){const $=v.indexOf(M);d?$<0&&(v.push(M),t(0,v)):$>=0&&(v.splice($,1),t(0,v))}function te(d){["Enter","Space"].includes(d.code)&&(d.preventDefault(),_.click())}const Y=[[]];function ue(d){re.call(this,n,d)}function ye(d){re.call(this,n,d)}function de(d){re.call(this,n,d)}function z(d){re.call(this,n,d)}function Ce(d){re.call(this,n,d)}function Se(d){re.call(this,n,d)}function ke(d){re.call(this,n,d)}function k(d){Ae[d?"unshift":"push"](()=>{_=d,t(6,_)})}function N(){V=this.checked,t(4,V)}function ie(d){Ae[d?"unshift":"push"](()=>{_=d,t(6,_)})}function ne(){v=this.__value,t(0,v)}return n.$$set=d=>{t(38,e=De(De({},e),Re(d))),"group"in d&&t(0,v=d.group),"name"in d&&t(1,L=d.name),"value"in d&&t(2,M=d.value),"multiple"in d&&t(3,p=d.multiple),"rounded"in d&&t(14,I=d.rounded),"active"in d&&t(15,E=d.active),"hover"in d&&t(16,K=d.hover),"padding"in d&&t(17,y=d.padding),"regionLead"in d&&t(18,S=d.regionLead),"regionDefault"in d&&t(19,f=d.regionDefault),"regionTrail"in d&&t(20,C=d.regionTrail),"$$scope"in d&&t(22,m=d.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&9&&p&&T(v),n.$$.dirty[0]&24&&p&&O(V),n.$$.dirty[0]&13&&t(5,o=p?v.some(d=>Ve(M,d)):Ve(v,M)),n.$$.dirty[0]&98336&&t(21,s=o?E:K),t(11,r=`${jt} ${I} ${y} ${s} ${e.class??""}`),n.$$.dirty[0]&262144&&t(9,a=`${Ot} ${S}`),n.$$.dirty[0]&524288&&t(8,c=`${Bt} ${f}`),n.$$.dirty[0]&1048576&&t(7,h=`${Ft} ${C}`)},t(10,i=`${Ut}`),e=Re(e),[v,L,M,p,V,o,_,h,c,a,i,r,te,b,I,E,K,y,S,f,C,s,m,u,ue,ye,de,z,Ce,Se,ke,k,N,ie,ne,Y]}class zt extends Xe{constructor(e){super(),Je(this,e,Vt,Wt,ze,{group:0,name:1,value:2,multiple:3,rounded:14,active:15,hover:16,padding:17,regionLead:18,regionDefault:19,regionTrail:20},null,[-1,-1])}}class le extends Error{constructor(e,t){const o=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=o}}class Ke extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class ee extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class Xt extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=o}}class Jt extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=o}}class Kt extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=o}}class Gt extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class Qt extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=o}}class bt{constructor(e,t,o){this.statusCode=e,this.statusText=t,this.content=o}}class We{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var l;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(l||(l={}));class ge{constructor(){}log(e,t){}}ge.instance=new ge;const Yt="7.0.12";class U{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,o){if(!(e in t))throw new Error(`Unknown ${o} value: ${e}.`)}}class j{static get isBrowser(){return typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return typeof self=="object"&&"importScripts"in self}static get isReactNative(){return typeof window=="object"&&typeof window.document>"u"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}function _e(n,e){let t="";return ve(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${Zt(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function Zt(n){const e=new Uint8Array(n);let t="";return e.forEach(o=>{const s=o<16?"0":"";t+=`0x${s}${o.toString(16)} `}),t.substr(0,t.length-1)}function ve(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function wt(n,e,t,o,s,r){const i={},[a,c]=he();i[a]=c,n.log(l.Trace,`(${e} transport) sending data. ${_e(s,r.logMessageContent)}.`);const h=ve(s)?"arraybuffer":"text",u=await t.post(o,{content:s,headers:{...i,...r.headers},responseType:h,timeout:r.timeout,withCredentials:r.withCredentials});n.log(l.Trace,`(${e} transport) request complete. Response status: ${u.statusCode}.`)}function qt(n){return n===void 0?new Ne(l.Information):n===null?ge.instance:n.log!==void 0?n:new Ne(n)}class $t{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class Ne{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const o=`[${new Date().toISOString()}] ${l[e]}: ${t}`;switch(e){case l.Critical:case l.Error:this.out.error(o);break;case l.Warning:this.out.warn(o);break;case l.Information:this.out.info(o);break;default:this.out.log(o);break}}}}function he(){let n="X-SignalR-User-Agent";return j.isNode&&(n="User-Agent"),[n,en(Yt,tn(),on(),nn())]}function en(n,e,t,o){let s="Microsoft SignalR/";const r=n.split(".");return s+=`${r[0]}.${r[1]}`,s+=` (${n}; `,e&&e!==""?s+=`${e}; `:s+="Unknown OS; ",s+=`${t}`,o?s+=`; ${o}`:s+="; Unknown Runtime Version",s+=")",s}function tn(){if(j.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function nn(){if(j.isNode)return process.versions.node}function on(){return j.isNode?"NodeJS":"Browser"}function at(n){return n.stack?n.stack:n.message?n.message:`${n}`}function sn(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}class rn extends We{constructor(e){if(super(),this._logger=e,typeof fetch>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,this._fetchType=t("node-fetch"),this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(sn());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new ee;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let o;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),o=new ee});let s=null;if(e.timeout){const c=e.timeout;s=setTimeout(()=>{t.abort(),this._logger.log(l.Warning,"Timeout from HTTP request."),o=new Ke},c)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},ve(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let r;try{r=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(c){throw o||(this._logger.log(l.Warning,`Error from HTTP request. ${c}.`),c)}finally{s&&clearTimeout(s),e.abortSignal&&(e.abortSignal.onabort=null)}if(!r.ok){const c=await ct(r,"text");throw new le(c||r.statusText,r.status)}const a=await ct(r,e.responseType);return new bt(r.status,r.statusText,a)}getCookieString(e){let t="";return j.isNode&&this._jar&&this._jar.getCookies(e,(o,s)=>t=s.join("; ")),t}}function ct(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=n.text();break}return t}class an extends We{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ee):e.method?e.url?new Promise((t,o)=>{const s=new XMLHttpRequest;s.open(e.method,e.url,!0),s.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(ve(e.content)?s.setRequestHeader("Content-Type","application/octet-stream"):s.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const r=e.headers;r&&Object.keys(r).forEach(i=>{s.setRequestHeader(i,r[i])}),e.responseType&&(s.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{s.abort(),o(new ee)}),e.timeout&&(s.timeout=e.timeout),s.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),s.status>=200&&s.status<300?t(new bt(s.status,s.statusText,s.response||s.responseText)):o(new le(s.response||s.responseText||s.statusText,s.status))},s.onerror=()=>{this._logger.log(l.Warning,`Error from HTTP request. ${s.status}: ${s.statusText}.`),o(new le(s.statusText,s.status))},s.ontimeout=()=>{this._logger.log(l.Warning,"Timeout from HTTP request."),o(new Ke)},s.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class cn extends We{constructor(e){if(super(),typeof fetch<"u"||j.isNode)this._httpClient=new rn(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new an(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ee):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class Q{static write(e){return`${e}${Q.RecordSeparator}`}static parse(e){if(e[e.length-1]!==Q.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(Q.RecordSeparator);return t.pop(),t}}Q.RecordSeparatorCode=30;Q.RecordSeparator=String.fromCharCode(Q.RecordSeparatorCode);class ln{writeHandshakeRequest(e){return Q.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,o;if(ve(e)){const a=new Uint8Array(e),c=a.indexOf(Q.RecordSeparatorCode);if(c===-1)throw new Error("Message is incomplete.");const h=c+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(a.slice(0,h))),o=a.byteLength>h?a.slice(h).buffer:null}else{const a=e,c=a.indexOf(Q.RecordSeparator);if(c===-1)throw new Error("Message is incomplete.");const h=c+1;t=a.substring(0,h),o=a.length>h?a.substring(h):null}const s=Q.parse(t),r=JSON.parse(s[0]);if(r.type)throw new Error("Expected a handshake response from the server.");return[o,r]}}var D;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close"})(D||(D={}));class hn{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new $t(this,e)}}const un=30*1e3,dn=15*1e3;var H;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(H||(H={}));class Ge{constructor(e,t,o,s){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(l.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},U.isRequired(e,"connection"),U.isRequired(t,"logger"),U.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=un,this.keepAliveIntervalInMilliseconds=dn,this._logger=t,this._protocol=o,this.connection=e,this._reconnectPolicy=s,this._handshakeProtocol=new ln,this.connection.onreceive=r=>this._processIncomingData(r),this.connection.onclose=r=>this._connectionClosed(r),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=H.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:D.Ping})}static create(e,t,o,s){return new Ge(e,t,o,s)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==H.Disconnected&&this._connectionState!==H.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==H.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=H.Connecting,this._logger.log(l.Debug,"Starting HubConnection.");try{await this._startInternal(),j.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=H.Connected,this._connectionStarted=!0,this._logger.log(l.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=H.Disconnected,this._logger.log(l.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,o)=>{this._handshakeResolver=t,this._handshakeRejecter=o});await this.connection.start(this._protocol.transferFormat);try{const t={protocol:this._protocol.name,version:this._protocol.version};if(this._logger.log(l.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(t)),this._logger.log(l.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(l.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){return this._connectionState===H.Disconnected?(this._logger.log(l.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===H.Disconnecting?(this._logger.log(l.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=H.Disconnecting,this._logger.log(l.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(l.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new ee("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))}stream(e,...t){const[o,s]=this._replaceStreamingParams(t),r=this._createStreamInvocation(e,t,s);let i;const a=new hn;return a.cancelCallback=()=>{const c=this._createCancelInvocation(r.invocationId);return delete this._callbacks[r.invocationId],i.then(()=>this._sendWithProtocol(c))},this._callbacks[r.invocationId]=(c,h)=>{if(h){a.error(h);return}else c&&(c.type===D.Completion?c.error?a.error(new Error(c.error)):a.complete():a.next(c.item))},i=this._sendWithProtocol(r).catch(c=>{a.error(c),delete this._callbacks[r.invocationId]}),this._launchStreams(o,i),a}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[o,s]=this._replaceStreamingParams(t),r=this._sendWithProtocol(this._createInvocation(e,t,!0,s));return this._launchStreams(o,r),r}invoke(e,...t){const[o,s]=this._replaceStreamingParams(t),r=this._createInvocation(e,t,!1,s);return new Promise((a,c)=>{this._callbacks[r.invocationId]=(u,m)=>{if(m){c(m);return}else u&&(u.type===D.Completion?u.error?c(new Error(u.error)):a(u.result):c(new Error(`Unexpected message type: ${u.type}`)))};const h=this._sendWithProtocol(r).catch(u=>{c(u),delete this._callbacks[r.invocationId]});this._launchStreams(o,h)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const o=this._methods[e];if(o)if(t){const s=o.indexOf(t);s!==-1&&(o.splice(s,1),o.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const o of t)switch(o.type){case D.Invocation:this._invokeClientMethod(o);break;case D.StreamItem:case D.Completion:{const s=this._callbacks[o.invocationId];if(s){o.type===D.Completion&&delete this._callbacks[o.invocationId];try{s(o)}catch(r){this._logger.log(l.Error,`Stream callback threw error: ${at(r)}`)}}break}case D.Ping:break;case D.Close:{this._logger.log(l.Information,"Close message received from server.");const s=o.error?new Error("Server returned an error on close: "+o.error):void 0;o.allowReconnect===!0?this.connection.stop(s):this._stopPromise=this._stopInternal(s);break}default:this._logger.log(l.Warning,`Invalid message type: ${o.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,o;try{[o,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(s){const r="Error parsing handshake response: "+s;this._logger.log(l.Error,r);const i=new Error(r);throw this._handshakeRejecter(i),i}if(t.error){const s="Server returned handshake error: "+t.error;this._logger.log(l.Error,s);const r=new Error(s);throw this._handshakeRejecter(r),r}else this._logger.log(l.Debug,"Server handshake complete.");return this._handshakeResolver(),o}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===H.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),o=this._methods[t];if(!o){this._logger.log(l.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(l.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const s=o.slice(),r=!!e.invocationId;let i,a,c;for(const h of s)try{const u=i;i=await h.apply(this,e.arguments),r&&i&&u&&(this._logger.log(l.Error,`Multiple results provided for '${t}'. Sending error to server.`),c=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),a=void 0}catch(u){a=u,this._logger.log(l.Error,`A callback for the method '${t}' threw error '${u}'.`)}c?await this._sendWithProtocol(c):r?(a?c=this._createCompletionMessage(e.invocationId,`${a}`,null):i!==void 0?c=this._createCompletionMessage(e.invocationId,null,i):(this._logger.log(l.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),c=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(c)):i&&this._logger.log(l.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(l.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new ee("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===H.Disconnecting?this._completeClose(e):this._connectionState===H.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===H.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=H.Disconnected,this._connectionStarted=!1,j.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(l.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let o=0,s=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),r=this._getNextRetryDelay(o++,0,s);if(r===null){this._logger.log(l.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=H.Reconnecting,e?this._logger.log(l.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(l.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(i=>i.apply(this,[e]))}catch(i){this._logger.log(l.Error,`An onreconnecting callback called with error '${e}' threw error '${i}'.`)}if(this._connectionState!==H.Reconnecting){this._logger.log(l.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;r!==null;){if(this._logger.log(l.Information,`Reconnect attempt number ${o} will start in ${r} ms.`),await new Promise(i=>{this._reconnectDelayHandle=setTimeout(i,r)}),this._reconnectDelayHandle=void 0,this._connectionState!==H.Reconnecting){this._logger.log(l.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=H.Connected,this._logger.log(l.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(i=>i.apply(this,[this.connection.connectionId]))}catch(i){this._logger.log(l.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${i}'.`)}return}catch(i){if(this._logger.log(l.Information,`Reconnect attempt failed because of error '${i}'.`),this._connectionState!==H.Reconnecting){this._logger.log(l.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===H.Disconnecting&&this._completeClose();return}s=i instanceof Error?i:new Error(i.toString()),r=this._getNextRetryDelay(o++,Date.now()-t,s)}}this._logger.log(l.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${o} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,o){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:o})}catch(s){return this._logger.log(l.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${s}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(o=>{const s=t[o];try{s(null,e)}catch(r){this._logger.log(l.Error,`Stream 'error' callback called with '${e}' threw error: ${at(r)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,o,s){if(o)return s.length!==0?{arguments:t,streamIds:s,target:e,type:D.Invocation}:{arguments:t,target:e,type:D.Invocation};{const r=this._invocationId;return this._invocationId++,s.length!==0?{arguments:t,invocationId:r.toString(),streamIds:s,target:e,type:D.Invocation}:{arguments:t,invocationId:r.toString(),target:e,type:D.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const o in e)e[o].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o)))},error:s=>{let r;s instanceof Error?r=s.message:s&&s.toString?r=s.toString():r="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o,r)))},next:s=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(o,s)))}})}}_replaceStreamingParams(e){const t=[],o=[];for(let s=0;s<e.length;s++){const r=e[s];if(this._isObservable(r)){const i=this._invocationId;this._invocationId++,t[i]=r,o.push(i.toString()),e.splice(s,1)}}return[t,o]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,o){const s=this._invocationId;return this._invocationId++,o.length!==0?{arguments:t,invocationId:s.toString(),streamIds:o,target:e,type:D.StreamInvocation}:{arguments:t,invocationId:s.toString(),target:e,type:D.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:D.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:D.StreamItem}}_createCompletionMessage(e,t,o){return t?{error:t,invocationId:e,type:D.Completion}:{invocationId:e,result:o,type:D.Completion}}}const fn=[0,2e3,1e4,3e4,null];class lt{constructor(e){this._retryDelays=e!==void 0?[...e,null]:fn}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class ae{}ae.Authorization="Authorization";ae.Cookie="Cookie";class gn extends We{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const o=await this._innerClient.send(e);return t&&o.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):o}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[ae.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[ae.Authorization]&&delete e.headers[ae.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var x;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(x||(x={}));var F;(function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"})(F||(F={}));let _n=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class ht{constructor(e,t,o){this._httpClient=e,this._logger=t,this._pollAbort=new _n,this._options=o,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}async connect(e,t){if(U.isRequired(e,"url"),U.isRequired(t,"transferFormat"),U.isIn(t,F,"transferFormat"),this._url=e,this._logger.log(l.Trace,"(LongPolling transport) Connecting."),t===F.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[o,s]=he(),r={[o]:s,...this._options.headers},i={abortSignal:this._pollAbort.signal,headers:r,timeout:1e5,withCredentials:this._options.withCredentials};t===F.Binary&&(i.responseType="arraybuffer");const a=`${e}&_=${Date.now()}`;this._logger.log(l.Trace,`(LongPolling transport) polling: ${a}.`);const c=await this._httpClient.get(a,i);c.statusCode!==200?(this._logger.log(l.Error,`(LongPolling transport) Unexpected response code: ${c.statusCode}.`),this._closeError=new le(c.statusText||"",c.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,i)}async _poll(e,t){try{for(;this._running;)try{const o=`${e}&_=${Date.now()}`;this._logger.log(l.Trace,`(LongPolling transport) polling: ${o}.`);const s=await this._httpClient.get(o,t);s.statusCode===204?(this._logger.log(l.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):s.statusCode!==200?(this._logger.log(l.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),this._closeError=new le(s.statusText||"",s.statusCode),this._running=!1):s.content?(this._logger.log(l.Trace,`(LongPolling transport) data received. ${_e(s.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(s.content)):this._logger.log(l.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(o){this._running?o instanceof Ke?this._logger.log(l.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=o,this._running=!1):this._logger.log(l.Trace,`(LongPolling transport) Poll errored after shutdown: ${o.message}`)}}finally{this._logger.log(l.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?wt(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(l.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(l.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,o]=he();e[t]=o;const s={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};await this._httpClient.delete(this._url,s),this._logger.log(l.Trace,"(LongPolling transport) DELETE request sent.")}finally{this._logger.log(l.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(l.Trace,e),this.onclose(this._closeError)}}}class pn{constructor(e,t,o,s){this._httpClient=e,this._accessToken=t,this._logger=o,this._options=s,this.onreceive=null,this.onclose=null}async connect(e,t){return U.isRequired(e,"url"),U.isRequired(t,"transferFormat"),U.isIn(t,F,"transferFormat"),this._logger.log(l.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((o,s)=>{let r=!1;if(t!==F.Text){s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let i;if(j.isBrowser||j.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const a=this._httpClient.getCookieString(e),c={};c.Cookie=a;const[h,u]=he();c[h]=u,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...c,...this._options.headers}})}try{i.onmessage=a=>{if(this.onreceive)try{this._logger.log(l.Trace,`(SSE transport) data received. ${_e(a.data,this._options.logMessageContent)}.`),this.onreceive(a.data)}catch(c){this._close(c);return}},i.onerror=a=>{r?this._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(l.Information,`SSE connected to ${this._url}`),this._eventSource=i,r=!0,o()}}catch(a){s(a);return}})}async send(e){return this._eventSource?wt(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class mn{constructor(e,t,o,s,r,i){this._logger=o,this._accessTokenFactory=t,this._logMessageContent=s,this._webSocketConstructor=r,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=i}async connect(e,t){U.isRequired(e,"url"),U.isRequired(t,"transferFormat"),U.isIn(t,F,"transferFormat"),this._logger.log(l.Trace,"(WebSockets transport) Connecting.");let o;return this._accessTokenFactory&&(o=await this._accessTokenFactory()),new Promise((s,r)=>{e=e.replace(/^http/,"ws");let i;const a=this._httpClient.getCookieString(e);let c=!1;if(j.isNode||j.isReactNative){const h={},[u,m]=he();h[u]=m,o&&(h[ae.Authorization]=`Bearer ${o}`),a&&(h[ae.Cookie]=a),i=new this._webSocketConstructor(e,void 0,{headers:{...h,...this._headers}})}else o&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o)}`);i||(i=new this._webSocketConstructor(e)),t===F.Binary&&(i.binaryType="arraybuffer"),i.onopen=h=>{this._logger.log(l.Information,`WebSocket connected to ${e}.`),this._webSocket=i,c=!0,s()},i.onerror=h=>{let u=null;typeof ErrorEvent<"u"&&h instanceof ErrorEvent?u=h.error:u="There was an error with the transport",this._logger.log(l.Information,`(WebSockets transport) ${u}.`)},i.onmessage=h=>{if(this._logger.log(l.Trace,`(WebSockets transport) data received. ${_e(h.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(h.data)}catch(u){this._close(u);return}},i.onclose=h=>{if(c)this._close(h);else{let u=null;typeof ErrorEvent<"u"&&h instanceof ErrorEvent?u=h.error:u="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(u))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(l.Trace,`(WebSockets transport) sending data. ${_e(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(l.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const ut=100;class bn{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,U.isRequired(e,"url"),this._logger=qt(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let o=null,s=null;if(j.isNode&&typeof require<"u"){const r=typeof __webpack_require__=="function"?__non_webpack_require__:require;o=r("ws"),s=r("eventsource")}!j.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:j.isNode&&!t.WebSocket&&o&&(t.WebSocket=o),!j.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:j.isNode&&!t.EventSource&&typeof s<"u"&&(t.EventSource=s),this._httpClient=new gn(t.httpClient||new cn(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||F.Binary,U.isIn(e,F,"transferFormat"),this._logger.log(l.Debug,`Starting connection with transfer format '${F[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(l.Error,t),await this._stopPromise,Promise.reject(new ee(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(l.Error,t),Promise.reject(new ee(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Qe(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(l.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(l.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(l.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(l.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===x.WebSockets)this.transport=this._constructTransport(x.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let o=null,s=0;do{if(o=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new ee("The connection was stopped during negotiation.");if(o.error)throw new Error(o.error);if(o.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(o.url&&(t=o.url),o.accessToken){const r=o.accessToken;this._accessTokenFactory=()=>r,this._httpClient._accessToken=r,this._httpClient._accessTokenFactory=void 0}s++}while(o.url&&s<ut);if(s===ut&&o.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,o,e)}this.transport instanceof ht&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(l.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(o){return this._logger.log(l.Error,"Failed to start the connection: "+o),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(o)}}async _getNegotiationResponse(e){const t={},[o,s]=he();t[o]=s;const r=this._resolveNegotiateUrl(e);this._logger.log(l.Debug,`Sending negotiation request: ${r}.`);try{const i=await this._httpClient.post(r,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(i.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${i.statusCode}'`));const a=JSON.parse(i.content);return(!a.negotiateVersion||a.negotiateVersion<1)&&(a.connectionToken=a.connectionId),a}catch(i){let a="Failed to complete negotiation with the server: "+i;return i instanceof le&&i.statusCode===404&&(a=a+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(l.Error,a),Promise.reject(new Gt(a))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,o,s){let r=this._createConnectUrl(e,o.connectionToken);if(this._isITransport(t)){this._logger.log(l.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(r,s),this.connectionId=o.connectionId;return}const i=[],a=o.availableTransports||[];let c=o;for(const h of a){const u=this._resolveTransportOrError(h,t,s);if(u instanceof Error)i.push(`${h.transport} failed:`),i.push(u);else if(this._isITransport(u)){if(this.transport=u,!c){try{c=await this._getNegotiationResponse(e)}catch(m){return Promise.reject(m)}r=this._createConnectUrl(e,c.connectionToken)}try{await this._startTransport(r,s),this.connectionId=c.connectionId;return}catch(m){if(this._logger.log(l.Error,`Failed to start the transport '${h.transport}': ${m}`),c=void 0,i.push(new Kt(`${h.transport} failed: ${m}`,x[h.transport])),this._connectionState!=="Connecting"){const b="Failed to select transport before stop() was called.";return this._logger.log(l.Debug,b),Promise.reject(new ee(b))}}}}return i.length>0?Promise.reject(new Qt(`Unable to connect to the server with any of the available transports. ${i.join(" ")}`,i)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case x.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new mn(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case x.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new pn(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case x.LongPolling:return new ht(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.transport.onclose=o=>this._stopConnection(o),this.transport.connect(e,t)}_resolveTransportOrError(e,t,o){const s=x[e.transport];if(s==null)return this._logger.log(l.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(wn(t,s))if(e.transferFormats.map(i=>F[i]).indexOf(o)>=0){if(s===x.WebSockets&&!this._options.WebSocket||s===x.ServerSentEvents&&!this._options.EventSource)return this._logger.log(l.Debug,`Skipping transport '${x[s]}' because it is not supported in your environment.'`),new Xt(`'${x[s]}' is not supported in your environment.`,s);this._logger.log(l.Debug,`Selecting transport '${x[s]}'.`);try{return this._constructTransport(s)}catch(i){return i}}else return this._logger.log(l.Debug,`Skipping transport '${x[s]}' because it does not support the requested transfer format '${F[o]}'.`),new Error(`'${x[s]}' does not support ${F[o]}.`);else return this._logger.log(l.Debug,`Skipping transport '${x[s]}' because it was disabled by the client.`),new Jt(`'${x[s]}' is disabled by the client.`,s)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(l.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(l.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(l.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(l.Error,`Connection disconnected with error '${e}'.`):this._logger.log(l.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(l.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(l.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!j.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(l.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=e.indexOf("?");let o=e.substring(0,t===-1?e.length:t);return o[o.length-1]!=="/"&&(o+="/"),o+="negotiate",o+=t===-1?"":e.substring(t),o.indexOf("negotiateVersion")===-1&&(o+=t===-1?"?":"&",o+="negotiateVersion="+this._negotiateVersion),o}}function wn(n,e){return!n||(e&n)!==0}class Qe{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new Pe,this._transportResult=new Pe,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new Pe),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new Pe;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):Qe._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(o){e.reject(o)}}}static _concatBuffers(e){const t=e.map(r=>r.byteLength).reduce((r,i)=>r+i),o=new Uint8Array(t);let s=0;for(const r of e)o.set(new Uint8Array(r),s),s+=r.byteLength;return o.buffer}}class Pe{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const vn="json";class yn{constructor(){this.name=vn,this.version=1,this.transferFormat=F.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=ge.instance);const o=Q.parse(e),s=[];for(const r of o){const i=JSON.parse(r);if(typeof i.type!="number")throw new Error("Invalid payload.");switch(i.type){case D.Invocation:this._isInvocationMessage(i);break;case D.StreamItem:this._isStreamItemMessage(i);break;case D.Completion:this._isCompletionMessage(i);break;case D.Ping:break;case D.Close:break;default:t.log(l.Information,"Unknown message type '"+i.type+"' ignored.");continue}s.push(i)}return s}writeMessage(e){return Q.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const Cn={trace:l.Trace,debug:l.Debug,info:l.Information,information:l.Information,warn:l.Warning,warning:l.Warning,error:l.Error,critical:l.Critical,none:l.None};function Sn(n){const e=Cn[n.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${n}`)}class kn{configureLogging(e){if(U.isRequired(e,"logging"),En(e))this.logger=e;else if(typeof e=="string"){const t=Sn(e);this.logger=new Ne(t)}else this.logger=new Ne(e);return this}withUrl(e,t){return U.isRequired(e,"url"),U.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return U.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new lt(e):this.reconnectPolicy=e:this.reconnectPolicy=new lt,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new bn(this.url,e);return Ge.create(t,this.logger||ge.instance,this.protocol||new yn,this.reconnectPolicy)}}function En(n){return n.log!==void 0}const In=async({url:n})=>{await vt();const e=Oe(fe).accessToken,t=new kn().withUrl(yt+"/hubs/chat",{accessTokenFactory:()=>e,headers:{"Access-Control-Allow-Origin":"*",Authorization:`Bearer ${e}`},withCredentials:!1}).withAutomaticReconnect().build();return await t.start(),{connection:t}},Bn=Object.freeze(Object.defineProperty({__proto__:null,load:In},Symbol.toStringTag,{value:"Module"}));async function Tn(n=""){let e;return n?e=await Ue(`/chats/${n}`,{method:"GET"}):e=await Ue("/chats",{method:"GET"}),await e.json()}async function Pn(n){return await(await Ue("/users/search",{method:"POST",body:JSON.stringify(n)})).json()}function Dn(n,e){let t;return(...o)=>{clearTimeout(t),t=setTimeout(()=>e(...o),n)}}function dt(n,e,t){const o=n.slice();return o[22]=e[t],o}function Rn(n){let e=n[22].user.email+"",t,o,s,r=n[22].lastMessage.text.slice(0,20)+(n[22].lastMessage.text.length>20?" ..":""),i,a;return{c(){t=He(e),o=Z(),s=R("small"),i=He(r),a=Z(),this.h()},l(c){t=Le(c,e),o=q(c),s=A(c,"SMALL",{class:!0});var h=W(s);i=Le(h,r),h.forEach(w),a=q(c),this.h()},h(){g(s,"class","opacity-50 text-xs m-0 ms-2 p-0")},m(c,h){J(c,t,h),J(c,o,h),J(c,s,h),P(s,i),J(c,a,h)},p(c,h){h&1&&e!==(e=c[22].user.email+"")&&Me(t,e),h&1&&r!==(r=c[22].lastMessage.text.slice(0,20)+(c[22].lastMessage.text.length>20?" ..":""))&&Me(i,r)},d(c){c&&(w(t),w(o),w(s),w(a))}}}function ft(n){let e,t,o;function s(a){n[14](a)}function r(){return n[15](n[22])}let i={name:"people",value:n[22],$$slots:{default:[Rn]},$$scope:{ctx:n}};return n[1]!==void 0&&(i.group=n[1]),e=new zt({props:i}),Ae.push(()=>Tt(e,"group",s)),e.$on("click",r),{c(){gt(e.$$.fragment)},l(a){_t(e.$$.fragment,a)},m(a,c){pt(e,a,c),o=!0},p(a,c){n=a;const h={};c&1&&(h.value=n[22]),c&262145&&(h.$$scope={dirty:c,ctx:n}),!t&&c&2&&(t=!0,h.group=n[1],kt(()=>t=!1)),e.$set(h)},i(a){o||(B(e.$$.fragment,a),o=!0)},o(a){G(e.$$.fragment,a),o=!1},d(a){mt(e,a)}}}function An(n){let e,t,o=nt(n[0]),s=[];for(let i=0;i<o.length;i+=1)s[i]=ft(dt(n,o,i));const r=i=>G(s[i],1,1,()=>{s[i]=null});return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=tt()},l(i){for(let a=0;a<s.length;a+=1)s[a].l(i);e=tt()},m(i,a){for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(i,a);J(i,e,a),t=!0},p(i,a){if(a&19){o=nt(i[0]);let c;for(c=0;c<o.length;c+=1){const h=dt(i,o,c);s[c]?(s[c].p(h,a),B(s[c],1)):(s[c]=ft(h),s[c].c(),B(s[c],1),s[c].m(e.parentNode,e))}for(Be(),c=o.length;c<s.length;c+=1)r(c);Fe()}},i(i){if(!t){for(let a=0;a<o.length;a+=1)B(s[a]);t=!0}},o(i){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)G(s[a]);t=!1},d(i){i&&w(e),It(s,i)}}}function Hn(n){var Ce,Se,ke;let e,t,o='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg>',s,r,i=(((Se=(Ce=n[1])==null?void 0:Ce.user)==null?void 0:Se.email)??"Select a chat")+"",a,c,h,u,m,b,v,L=((ke=n[5])==null?void 0:ke.email)+"",M,p,I,E="Logout",K,y,S,f,C,V="Contacts",_,T,O,te,Y,ue,ye;T=new Ht({props:{active:"variant-filled-primary",$$slots:{default:[An]},$$scope:{ctx:n}}});const de=n[10].default,z=pe(de,n,n[18],null);return{c(){e=R("div"),t=R("button"),t.innerHTML=o,s=Z(),r=R("p"),a=He(i),c=Z(),h=R("div"),u=R("div"),m=R("header"),b=R("div"),v=R("span"),M=He(L),p=Z(),I=R("button"),I.textContent=E,K=Z(),y=R("input"),S=Z(),f=R("div"),C=R("small"),C.textContent=V,_=Z(),gt(T.$$.fragment),O=Z(),te=R("div"),z&&z.c(),this.h()},l(k){e=A(k,"DIV",{class:!0});var N=W(e);t=A(N,"BUTTON",{"data-svelte-h":!0}),je(t)!=="svelte-s405t3"&&(t.innerHTML=o),s=q(N),r=A(N,"P",{class:!0});var ie=W(r);a=Le(ie,i),ie.forEach(w),N.forEach(w),c=q(k),h=A(k,"DIV",{class:!0});var ne=W(h);u=A(ne,"DIV",{class:!0});var d=W(u);m=A(d,"HEADER",{class:!0});var $=W(m);b=A($,"DIV",{class:!0});var Ee=W(b);v=A(Ee,"SPAN",{class:!0});var Ye=W(v);M=Le(Ye,L),Ye.forEach(w),p=q(Ee),I=A(Ee,"BUTTON",{class:!0,"data-svelte-h":!0}),je(I)!=="svelte-1mc79kk"&&(I.textContent=E),Ee.forEach(w),K=q($),y=A($,"INPUT",{class:!0,type:!0,placeholder:!0}),$.forEach(w),S=q(d),f=A(d,"DIV",{class:!0});var Ie=W(f);C=A(Ie,"SMALL",{class:!0,"data-svelte-h":!0}),je(C)!=="svelte-1h2advl"&&(C.textContent=V),_=q(Ie),_t(T.$$.fragment,Ie),Ie.forEach(w),d.forEach(w),O=q(ne),te=A(ne,"DIV",{class:!0});var Ze=W(te);z&&z.l(Ze),Ze.forEach(w),ne.forEach(w),this.h()},h(){g(r,"class","flex-1 text-center"),g(e,"class","fixed flex flex-row justify-between left-0 right-0 top-0 md:hidden bg-surface-50-900-token ring-2 p-2 px-4 z-10"),g(v,"class","flex-1 text-secondary-800-100-token"),g(I,"class","btn variant-soft-error"),g(b,"class","flex flex-row items-center justify-between gap-2"),g(y,"class","input"),g(y,"type","search"),g(y,"placeholder","Search..."),g(m,"class","border-b border-surface-500/30 p-4 flex flex-col gap-2"),g(C,"class","opacity-50"),g(f,"class","p-4 space-y-4 overflow-y-auto"),g(u,"class","max-w-xs border-r border-surface-500/30 bg-surface-50-900-token fixed md:relative min-h-screen z-10 transition-all md:visible md:opacity-100"),Te(u,"invisible",n[4]),Te(u,"opacity-0",n[4]),g(te,"class","contents"),g(h,"class","chat w-full flex flex-row")},m(k,N){J(k,e,N),P(e,t),P(e,s),P(e,r),P(r,a),J(k,c,N),J(k,h,N),P(h,u),P(u,m),P(m,b),P(b,v),P(v,M),P(b,p),P(b,I),P(m,K),P(m,y),ce(y,n[3]),P(u,S),P(u,f),P(f,C),P(f,_),pt(T,f,null),P(h,O),P(h,te),z&&z.m(te,null),n[17](te),Y=!0,ue||(ye=[X(t,"click",n[11]),X(I,"click",n[12]),X(y,"input",n[13]),X(y,"input",n[6]),X(te,"click",n[16])],ue=!0)},p(k,[N]){var ne,d,$;(!Y||N&2)&&i!==(i=(((d=(ne=k[1])==null?void 0:ne.user)==null?void 0:d.email)??"Select a chat")+"")&&Me(a,i),(!Y||N&32)&&L!==(L=(($=k[5])==null?void 0:$.email)+"")&&Me(M,L),N&8&&y.value!==k[3]&&ce(y,k[3]);const ie={};N&262163&&(ie.$$scope={dirty:N,ctx:k}),T.$set(ie),(!Y||N&16)&&Te(u,"invisible",k[4]),(!Y||N&16)&&Te(u,"opacity-0",k[4]),z&&z.p&&(!Y||N&262144)&&me(z,de,k,k[18],Y?we(de,k[18],N,null):be(k[18]),null)},i(k){Y||(B(T.$$.fragment,k),B(z,k),Y=!0)},o(k){G(T.$$.fragment,k),G(z,k),Y=!1},d(k){k&&(w(e),w(c),w(h)),mt(T),z&&z.d(k),n[17](null),ue=!1,xe(ye)}}}function Ln(n,e,t){let o,s,r;et(n,Pt,_=>t(9,s=_)),et(n,fe,_=>t(5,r=_));let{$$slots:i={},$$scope:a}=e,c,h,u="",m=[],b=[],{data:v}=e,L=!0;const M=Dn(500,async()=>{if(await p(),t(0,b=m.filter(T=>T.user.email.includes(u))),u.length<5)return;const _=await Pn(u);for(const T of _)b.find(O=>O.user.email===T.email)||T.id!=Oe(fe).id&&t(0,b=[...b,{user:T,lastMessage:{text:""}}])});async function p(){$e.set(!0),m=(await Tn()).sort((T,O)=>new Date(O.lastMessage.createdAt).getTime()-new Date(T.lastMessage.createdAt).getTime()),t(0,b=m),$e.set(!1)}function I(_){_.senderId===Oe(fe).id?m=[{user:_.receiver,lastMessage:_},...m.filter(O=>O.user.id!==_.receiverId)]:m=[{user:_.sender,lastMessage:_},...m.filter(O=>O.user.id!==_.senderId)],t(0,b=m),c.user.id===_.senderId&&t(1,c=m[0])}St(()=>{o&&(o.off("ReceiveMessage",I),o.stop())}),p();const E=()=>t(4,L=!L),K=()=>{fe.set(null),qe("/")};function y(){u=this.value,t(3,u)}function S(_){c=_,t(1,c),t(9,s),t(0,b)}const f=_=>{qe(`/chats/${_.user.id}`),t(4,L=!0)},C=()=>t(4,L=!0);function V(_){Ae[_?"unshift":"push"](()=>{h=_,t(2,h)})}return n.$$set=_=>{"data"in _&&t(7,v=_.data),"$$scope"in _&&t(18,a=_.$$scope)},n.$$.update=()=>{if(n.$$.dirty&513&&s.params.email){const _=b.find(T=>T.user.id===s.params.email);_&&t(1,c=_)}n.$$.dirty&128&&t(8,o=v.connection),n.$$.dirty&256&&o&&(o.off("ReceiveMessage",I),o.on("ReceiveMessage",I))},[b,c,h,u,L,r,M,v,o,s,i,E,K,y,S,f,C,V,a]}class Fn extends Xe{constructor(e){super(),Je(this,e,Ln,Hn,ze,{data:7})}}export{Fn as component,Bn as universal};
