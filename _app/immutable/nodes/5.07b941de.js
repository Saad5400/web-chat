import{s as Q,n as N,r as Z,p as x,g as $,b as L}from"../chunks/scheduler.7a7c0b35.js";import{S as ee,i as te,g as I,s as P,G as F,h as y,j as v,f as _,c as O,H as G,k as i,a as J,x as f,B as K,z as R,E as se,m as U,n as V,D as j,o as z}from"../chunks/index.0a1868cf.js";import{e as Y}from"../chunks/each.e59479a4.js";import{p as ae}from"../chunks/stores.5f8033b7.js";import{g as re}from"../chunks/get.4329af93.js";import{a as ne}from"../chunks/apiFetch.bc854194.js";import{l as H,a as oe}from"../chunks/loadingStore.store.cd0289c0.js";const le="auto",ve=Object.freeze(Object.defineProperty({__proto__:null,prerender:le},Symbol.toStringTag,{value:"Module"}));async function ie(e){return await(await ne(`/messages/${e}`,{method:"GET"})).json()}function q(e,n,s){const o=e.slice();return o[20]=n[s],o}function W(e){let n,s,o,w,p=(e[20].senderId===e[4].id?e[4].email:"You")+"",m,d,g,u=e[20].createdAt+"",c,b,E,M=e[20].text+"",T,k;return{c(){n=I("div"),s=I("div"),o=I("header"),w=I("p"),m=U(p),d=P(),g=I("small"),c=U(u),b=P(),E=I("p"),T=U(M),k=P(),this.h()},l(t){n=y(t,"DIV",{class:!0});var a=v(n);s=y(a,"DIV",{class:!0});var h=v(s);o=y(h,"HEADER",{class:!0});var l=v(o);w=y(l,"P",{class:!0});var D=v(w);m=V(D,p),D.forEach(_),d=O(l),g=y(l,"SMALL",{class:!0});var A=v(g);c=V(A,u),A.forEach(_),l.forEach(_),b=O(h),E=y(h,"P",{class:!0});var S=v(E);T=V(S,M),S.forEach(_),h.forEach(_),k=O(a),a.forEach(_),this.h()},h(){i(w,"class","font-bold me-2"),i(g,"class","opacity-50"),i(o,"class","flex justify-between items-center"),i(E,"class","break-all whitespace-pre-wrap"),i(s,"class","card p-4 space-y-2 w-fit"),j(s,"variant-soft-primary",e[20].senderId!==e[4].id),j(s,"rounded-tr-none",e[20].senderId===e[4].id),j(s,"rounded-tl-none",e[20].senderId!==e[4].id),i(n,"class","gap-2 flex flex-row"),j(n,"justify-end",e[20].senderId===e[4].id)},m(t,a){J(t,n,a),f(n,s),f(s,o),f(o,w),f(w,m),f(o,d),f(o,g),f(g,c),f(s,b),f(s,E),f(E,T),f(n,k)},p(t,a){a&48&&p!==(p=(t[20].senderId===t[4].id?t[4].email:"You")+"")&&z(m,p),a&32&&u!==(u=t[20].createdAt+"")&&z(c,u),a&32&&M!==(M=t[20].text+"")&&z(T,M),a&48&&j(s,"variant-soft-primary",t[20].senderId!==t[4].id),a&48&&j(s,"rounded-tr-none",t[20].senderId===t[4].id),a&48&&j(s,"rounded-tl-none",t[20].senderId!==t[4].id),a&48&&j(n,"justify-end",t[20].senderId===t[4].id)},d(t){t&&_(n)}}}function de(e){let n,s,o,w,p,m,d,g,u,c,b,E,M,T,k=Y(e[5]),t=[];for(let a=0;a<k.length;a+=1)t[a]=W(q(e,k,a));return{c(){n=I("div"),s=I("section"),o=I("div");for(let a=0;a<t.length;a+=1)t[a].c();w=P(),p=I("section"),m=I("div"),d=I("textarea"),g=P(),u=I("button"),c=F("svg"),b=F("path"),this.h()},l(a){n=y(a,"DIV",{class:!0});var h=v(n);s=y(h,"SECTION",{class:!0});var l=v(s);o=y(l,"DIV",{class:!0});var D=v(o);for(let B=0;B<t.length;B+=1)t[B].l(D);D.forEach(_),l.forEach(_),w=O(h),p=y(h,"SECTION",{class:!0});var A=v(p);m=y(A,"DIV",{class:!0});var S=v(m);d=y(S,"TEXTAREA",{class:!0,rows:!0,name:!0,id:!0,placeholder:!0}),v(d).forEach(_),g=O(S),u=y(S,"BUTTON",{class:!0});var r=v(u);c=G(r,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var C=v(c);b=G(C,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),v(b).forEach(_),C.forEach(_),r.forEach(_),S.forEach(_),A.forEach(_),h.forEach(_),this.h()},h(){i(o,"class","p-4 space-y-4 my-10 md:mt-0"),i(s,"class","flex-initial h-full overflow-y-scroll min-h-[100dvh] max-h-[100dvh]"),i(d,"class","bg-transparent border-0 ring-0 flex-1"),i(d,"rows","1"),i(d,"name","prompt"),i(d,"id","prompt"),i(d,"placeholder","Write a message..."),i(b,"stroke-linecap","round"),i(b,"stroke-linejoin","round"),i(b,"d","M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"),i(c,"xmlns","http://www.w3.org/2000/svg"),i(c,"fill","none"),i(c,"viewBox","0 0 24 24"),i(c,"stroke-width","1.5"),i(c,"stroke","currentColor"),i(c,"class","w-6 h-6"),i(u,"class",E=e[3]?"variant-filled-primary":"input-group-shim"),i(m,"class","input-group input-group-divider variant-glass-primary variant-form-material flex flex-row w-full rounded-none"),i(p,"class","h-fit bottom-0 left-0 right-0 absolute"),i(n,"class","flex flex-col flex-1 md:mt-0 relative")},m(a,h){J(a,n,h),f(n,s),f(s,o);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(o,null);e[10](o),e[11](s),f(n,w),f(n,p),f(p,m),f(m,d),e[12](d),K(d,e[3]),f(m,g),f(m,u),f(u,c),f(c,b),M||(T=[R(d,"input",e[13]),R(d,"keydown",e[6]),R(u,"click",e[7])],M=!0)},p(a,[h]){if(h&48){k=Y(a[5]);let l;for(l=0;l<k.length;l+=1){const D=q(a,k,l);t[l]?t[l].p(D,h):(t[l]=W(D),t[l].c(),t[l].m(o,null))}for(;l<t.length;l+=1)t[l].d(1);t.length=k.length}h&8&&K(d,a[3]),h&8&&E!==(E=a[3]?"variant-filled-primary":"input-group-shim")&&i(u,"class",E)},i:N,o:N,d(a){a&&_(n),se(t,a),e[10](null),e[11](null),e[12](null),M=!1,Z(T)}}}function X(e){let n;return e?(n=new Date(e),n=new Date(n.getTime()-n.getTimezoneOffset()*6e4)):n=new Date,n.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})}function ue(e,n,s){let o,{data:w}=n,p,m,d,g="",u,c=[];async function b(r){let C=await(await re("",r)).json();s(4,u=C[0])}async function E(){H.set(!0);const r=await ie(u.id);s(5,c=r.map(C=>({...C,createdAt:X(C.createdAt)}))),H.set(!1)}const M=ae.subscribe(async r=>{s(3,g=""),s(4,u={}),s(5,c=[]),r.params.email&&(await b(r.params.email),await E(),T())});function T(r){p.scrollTo({top:p.scrollHeight,behavior:r})}function k(r){["Enter"].includes(r.code)&&!r.shiftKey&&(r.preventDefault(),a())}function t(r){s(5,c=[...c,r]),setTimeout(()=>{T("smooth")},10)}function a(){d.focus();const r={text:g,receiverId:u.id,senderId:$(oe).id};o.invoke("SendMessage",r),s(3,g="")}function h(r){r.senderId!==u.id&&r.receiverId!==u.id||(r.createdAt=X(),t(r))}x(()=>{M(),o&&o.off("ReceiveMessage",h),H.set(!1)});function l(r){L[r?"unshift":"push"](()=>{m=r,s(1,m)})}function D(r){L[r?"unshift":"push"](()=>{p=r,s(0,p)})}function A(r){L[r?"unshift":"push"](()=>{d=r,s(2,d)})}function S(){g=this.value,s(3,g)}return e.$$set=r=>{"data"in r&&s(8,w=r.data)},e.$$.update=()=>{e.$$.dirty&256&&s(9,{connection:o}=w,o),e.$$.dirty&512&&o&&(o.off("ReceiveMessage",h),o.on("ReceiveMessage",h))},[p,m,d,g,u,c,k,a,w,o,l,D,A,S]}class we extends ee{constructor(n){super(),te(this,n,ue,de,Q,{data:8})}}export{we as component,ve as universal};
